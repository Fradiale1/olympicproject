{% extends 'index.html' %}

{% load static %}

{% block head %}
<script type="text/javascript" src="{% static 'js/features/host.js' %}"></script>
{% endblock %}

{% block content %}

<div class="d-flex justify-content-end w-100 px-4 pt-2 mb-3">
    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createModal" onclick="openCreateModal()">Aggiungi</button>
</div>
<!--searchbar-->
<div class="row px-4 mx-auto w-100">
    <form action="{% url 'search_host' %}" method="GET" class="mb-4 px-0">
        <div class="d-flex align-items-center">
            <input type="text" name="string_searchbar" class="form-control flex-grow-1 me-2" placeholder="Cerca per nome...">
            <button type="submit" class="btn btn-primary">Cerca</button>
        </div>
    </form>
</div>
<!--filter-->
<div class="row px-4 mx-auto w-100">
    <form action="{% url 'filter_by_season' %}" method="GET" class="mb-4 px-0" id="seasonFilterForm">
        <div class="d-flex align-items-center">
            <label class="me-2">Seleziona stagione:</label>
            <select name="season" class="form-control flex-grow-1 me-2" onchange="document.getElementById('seasonFilterForm').submit();">
                <option value="">Seleziona</option>
                <option value="Summer">Estate</option>
                <option value="Winter">Inverno</option>
            </select>
        </div>
    </form>
</div>
<!--card-->
<div class="row p-4 mx-auto w-100">
    {% for host in page_obj %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="bg-white rounded shadow p-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h3 class="h5 font-weight-semibold">{{ host.game_name }}</h3>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-muted">Season: {{ host.game_season }}</span>
                </div>
                <div class="mt-4">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal" onclick="openUpdateModal('{{ host.id }}')">Modifica</button>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" onclick="openDeleteModal('{{ host.id }}')">Cancella</button>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
<!--pagination-->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-end p-4">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{% if request.GET.string_searchbar %}string_searchbar={{ request.GET.string_searchbar }}&{% endif %}{% if request.GET.season %}season={{ request.GET.season }}&{% endif %}page=1" aria-label="First">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if request.GET.string_searchbar %}string_searchbar={{ request.GET.string_searchbar }}&{% endif %}{% if request.GET.season %}season={{ request.GET.season }}&{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-label="First">&laquo;&laquo;</span>
            </li>
            <li class="page-item disabled">
                <span class="page-link" aria-label="Previous">&laquo;</span>
            </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item"><a class="page-link" href="?{% if request.GET.string_searchbar %}string_searchbar={{ request.GET.string_searchbar }}&{% endif %}{% if request.GET.season %}season={{ request.GET.season }}&{% endif %}page={{ num }}">{{ num }}</a></li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% if request.GET.string_searchbar %}string_searchbar={{ request.GET.string_searchbar }}&{% endif %}{% if request.GET.season %}season={{ request.GET.season }}&{% endif %}page={{ page_obj.next_page_number }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if request.GET.string_searchbar %}string_searchbar={{ request.GET.string_searchbar }}&{% endif %}{% if request.GET.season %}season={{ request.GET.season }}&{% endif %}page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                    <span aria-hidden="true">&raquo;&raquo;</span>
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-label="Next">&raquo;</span>
            </li>
            <li class="page-item disabled">
                <span class="page-link" aria-label="Last">&raquo;&raquo;</span>
            </li>
        {% endif %}
    </ul>
</nav>



<div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="createForm" method="post" action="{% url 'create_host' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createModalLabel">Creazione Host</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"> 
                    <div class="mb-3">
                        <label for="GameNameCreate" class="form-label">Nome Gara</label>
                        <input class="form-control" id="GameNameCreate" type="text" placeholder="(Nome e Anno)" name="game_name_create" aria-label="default input example">
                    </div> 
                   <!-- <div class="mb-3">
                        <label for="SlugCreate" class="form-label">Titolo</label>
                        <input class="form-control" id="SlugCreate" type="text" name="slug_create" placeholder="(Nome-Anno)" aria-label="default input example">
                    </div>-->
                    <div class="mb-3">
                        <label for="BeginDateCreate" class="form-label">Data di Inizio</label>
                        <input class="form-control" id="BeginDateCreate" type="date" name="begin_date_create" placeholder="Data di Inizio" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="EndDateCreate" class="form-label">Data di Fine</label>
                        <input class="form-control" id="EndDateCreate" type="date" name="end_date_create" placeholder="Data di Fine" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="LocationCreate" class="form-label">Paese</label>
                        <input class="form-control" id="LocationCreate" type="text" placeholder="Paese" name="location_create" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="SeasonCreate" class="form-label">Stagione</label>
                        <input class="form-control" id="SeasonCreate" type="text" placeholder="Stagione" name="season_create" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="GameYearCreate" class="form-label">Anno</label>
                        <input class="form-control" id="GameYearCreate" type="number" min="1900" max="2099" name="game_year_create" placeholder="Anno Gara" aria-label="default input example">
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-success">Aggiungi</button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="updateForm" method="post" action="{% url 'update_host' %}">
            {% csrf_token %} 
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="updateModalLabel">Modifica Host</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="host_id_update" id="hostIdInputUpdate">
                  <div class="mb-3">
                       <!-- <label for="SlugUpdate" class="form-label">Titolo</label>
                        <input class="form-control" id="SlugUpdate" type="text" name="slug_update" placeholder="(Nome-Anno)" aria-label="default input example">
                        -->
                        <input type="hidden" name="slug_update" id="SlugUpdate">
                    </div>   
                    <div class="mb-3">
                        <label for="GameNameUpdate" class="form-label">Nome Gara</label>
                        <input class="form-control" id="GameNameUpdate" type="text" placeholder="(Nome e Anno)" name="game_name_update" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="BeginDateUpdate" class="form-label">Data di Inizio</label>
                        <input class="form-control" id="BeginDateUpdate" type="date" name="begin_date_update" placeholder="Data di Inizio" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="EndDateUpdate" class="form-label">Data di Fine</label>
                        <input class="form-control" id="EndDateUpdate" type="date" name="end_date_update" placeholder="Data di Fine" aria-label="default input example">
                    </div>
                    
                    <div class="mb-3">
                        <label for="LocationUpdate" class="form-label">Paese</label>
                        <input class="form-control" id="LocationUpdate" type="text" placeholder="Paese" name="location_update" aria-label="default input example">
                    </div>

                    <div class="mb-3">
                        <label for="SeasonUpdate" class="form-label">Stagione</label>
                        <input class="form-control" id="SeasonUpdate" type="text" placeholder="Stagione" name="season_update" aria-label="default input example">
                    </div>
                    <div class="mb-3">
                        <label for="GameYearUpdate" class="form-label">Anno</label>
                        <input class="form-control" id="GameYearUpdate" type="number" min="1900" max="2099" name="game_year_update" placeholder="Anno Gara" aria-label="default input example">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-success">Modifica</button>
                </div>
            </form>
        </div>
    </div>
</div>



<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="deleteForm" method="post" action="{% url 'delete_host' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="deleteModalLabel">Conferma Eliminazione</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Sei sicuro di voler eliminare questo host?
                    <input type="hidden" name="host_id_delete" id="hostIdInputDelete">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-danger">Confermo</button>
                </div>
            </form>
        </div>
    </div>
</div>


{% endblock %}